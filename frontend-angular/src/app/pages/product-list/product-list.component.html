<!-- Product listing page with search and pagination -->
<div class="container">
  <div class="header">
    <h1>Products</h1>
    <a
      *ngIf="authService.isSeller()"
      routerLink="/dashboard"
      class="btn btn-primary"
    >
      Manage My Products
    </a>
  </div>

  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      placeholder="Search products..."
      (keyup.enter)="search()"
    />
    <input
      type="text"
      [(ngModel)]="category"
      placeholder="Category"
      (keyup.enter)="search()"
    />
    <input
      type="number"
      [(ngModel)]="minPrice"
      placeholder="Min price"
      (keyup.enter)="search()"
    />
    <input
      type="number"
      [(ngModel)]="maxPrice"
      placeholder="Max price"
      (keyup.enter)="search()"
    />
    <label class="checkbox">
      <input type="checkbox" [(ngModel)]="inStockOnly" />
      In stock only
    </label>
    <button (click)="search()">Apply</button>
    <button class="btn-secondary" (click)="resetFilters()">Reset</button>
  </div>

  <div class="product-grid" *ngIf="products.length; else noProducts">
    <div class="product-card" *ngFor="let product of products">
      <div class="product-image">
        <img
          *ngIf="product.mediaIds?.length"
          [src]="'/api/media/' + product.mediaIds[0]"
          [alt]="product.name"
          (error)="onImageError($event)"
        />
        <div *ngIf="!product.mediaIds?.length" class="no-image">No Image</div>
      </div>
      <div class="product-info">
        <h3>{{ product.name }}</h3>
        <p class="description">
          {{ product.description || "No description" }}
        </p>
        <p class="category" *ngIf="product.category">
          Category: {{ product.category }}
        </p>
        <p class="price">{{ product.price | currency }}</p>
        <p class="stock" *ngIf="product.quantity !== undefined">
          {{ product.quantity > 0 ? "In stock" : "Out of stock" }}
        </p>
        <button
          class="btn btn-primary"
          [disabled]="product.quantity !== undefined && product.quantity <= 0"
          (click)="addToCart(product)"
        >
          Add to cart
        </button>
        <button class="btn btn-secondary" (click)="toggleFavorite(product)">
          {{
            isFavorite(product.id) ? "Remove from wishlist" : "Add to wishlist"
          }}
        </button>
      </div>
    </div>
  </div>

  <ng-template #noProducts>
    <div class="no-products">
      <p>No products found.</p>
    </div>
  </ng-template>

  <div class="pagination" *ngIf="totalPages > 1">
    <button [disabled]="currentPage === 0" (click)="loadPage(currentPage - 1)">
      Previous
    </button>
    <span>Page {{ currentPage + 1 }} of {{ totalPages }}</span>
    <button
      [disabled]="currentPage >= totalPages - 1"
      (click)="loadPage(currentPage + 1)"
    >
      Next
    </button>
  </div>
</div>
